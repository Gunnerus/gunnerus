{% extends 'reserver/base.html' %}
{% load bootstrap3 %}
{% block content %}

{# Display a form #}
<section class="container">
	{% bootstrap_messages %}
	<div class="page-header">
		<h1>{% block header %}{% endblock %}</h1>
	</div>
	<div class="page-header">
		<h3>Ordering Information</h3>
	</div>
	<div class="container">
		<ul>
			<li>You will receive a confirmation email when your booking has been accepted.</li>
			<li>Cancellations later than three weeks before the cruise will be charged in full.</li>
			<li>If meals are to be arranged by the ship, the relevant items below must be filled in correctly at least one month before the start date of the cruise.</li>
		</ul>
	</div>
	<form action="{{ request.path }}" method="post" class="form">
		{% csrf_token %}
		{% if cruiseday_form %}
		<div class="page-header">
			<h3>Select Cruise Days</h3>
		</div>
		<div class="cruiseDaysContainer">
			{{ cruiseday_form.management_form }}
			{{ cruiseday_form.non_form_errors }}
			{% for form in cruiseday_form %}
				<div class="cruiseDayForm">
					<div class="panel-heading">Cruise day</div>
					<div class="panel-body">
						<div class="panel panel-default calendar calendarContainer">
							<div class="panel-heading nav nav-default">
								<div class="pull-left">
									<h3>Cruise Calendar <span class="label label-default dateLabel">May 2017</span></h3>
								</div>
								<div class="btn-toolbar pull-right" role="group" aria-label="...">
									<div class="btn-group">
								  <button type="button" class="btn btn-default calPreviousButton"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span></button>
								  <button type="button" class="btn btn-default calNextButton"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span></button>
								  <button type="button" class="btn btn-default calTodayButton">Today</button>
									</div>
								  <div class="btn-group" role="group">
									<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
									  View
									  <span class="caret"></span>
									</button>
									<ul class="dropdown-menu">
										<li><a href="#" class="calYearButton">Year</a></li>
										<li><a href="#" class="calMonthButton">Month</a></li>
										<!--<li><a href="#" class="calWeekButton">Week</a></li>
										<li><a href="#" class="calDayButton">Day</a></li>-->
									</ul>
								  </div>
								</div>
							</div>
						  <div class="panel-body">
							<div class="insert-calendar"></div>
						  </div>
						  <div class="panel-footer">
							<div class="btn-toolbar" role="group" aria-label="...">
							  <div class="btn-group pull-left">
									 <button type="button" class="btn btn-default calPreviousButton"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span></button>
							  </div>
							  <div class="btn-group pull-right">
								  <button type="button" class="btn btn-default calNextButton"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span></button>
							  </div>
							 </div>
						  </div>
						</div>
						{% bootstrap_form form %}
					</div>
				</div>
			{% endfor %}
		</div>
		<div class="page-header">
			<h3>General Information</h3>
		</div>
		<div class="container">
			<h4>Terms and Conditions</h4>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.  Duis sit amet molestie turpis. Nulla viverra hendrerit tellus, sit amet dignissim ipsum vulputate ac. Aliquam sodales maximus malesuada. Aliquam mauris magna, tempus vel blandit eu, euismod sit amet libero. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.</p>
			<p>Suspendisse arcu nisi, iaculis nec fringilla vitae, rutrum condimentum nisl. Sed condimentum sit amet diam nec ultrices. Praesent eu metus enim. Integer hendrerit, diam vel euismod interdum, arcu eros laoreet mi, porttitor iaculis turpis felis a neque. Quisque molestie luctus ligula a sodales. Sed rhoncus enim turpis, in interdum orci fermentum nec.</p>
		</div>
		{% bootstrap_form form %}
		{% endif %}
		<div class="page-header">
			<h3>Add Participants</h3>
		</div>
		{% if participant_form %}
		<div class="cruiseParticipantsContainer">
			{{ participant_form.management_form }}
			{{ participant_form.non_form_errors }}
			{% for form in participant_form %}
				<div class="participantForm">
					<div class="panel-heading">Participant</div>
					<div class="panel-body">
						{% bootstrap_form form %}
					</div>
				</div>
			{% endfor %}
		</div>
		{% endif %}
		{% block submitbuttons %}{% endblock %}
	</form>
</section>
{% endblock %}
{% block scripts %}
<script type="text/javascript">
	var wrap = function(row){ 
		$(row).addClass("panel panel-default"); 
		$(row).find(".delete-row").addClass("btn btn-danger"); 
		$(".foodSelector").each(function() {
			checkAndHideFoodFields(this);
		});
		var calendar = new Calendar($(row).find(".calendarContainer"));
	};
	
	$(".foodSelector, .add-cruise-day").click(function(e) {
		checkAndHideFoodFields(e.target);
	});
	
	function checkAndHideFoodFields(food_selector) {
		food_selector = $(food_selector);
		form = food_selector.closest(".cruiseDayForm");
		if (food_selector.prop('checked')) {
			food_selector.closest(".cruiseDayForm").find(".food").closest(".form-group").show();
		} else {
			food_selector.closest(".cruiseDayForm").find(".food").closest(".form-group").hide();
		}
	}
	
	/*$(".noStudentSelector").click(function(e) {
		checkAndHideStudentField(e.target);
	});
	
	function checkAndHideStudentField(nostudentreason_selector) {
		nostudentreason_selector = $(food_selector);
		form = nostudentreason_selector.closest(".cruiseDayForm");
		if (nostudentreason_selector.prop('checked')) {
			nostudentreason_selector.closest(".cruiseDayForm").find(".food").closest(".form-group").show();
		} else {
			nostudentreason_selector.closest(".cruiseDayForm").find(".food").closest(".form-group").hide();
		}
	}*/
	
	
	function checkAndHideFoodFields(food_selector) {
		food_selector = $(food_selector);
		form = food_selector.closest(".cruiseDayForm");
		if (food_selector.prop('checked')) {
			food_selector.closest(".cruiseDayForm").find(".food").closest(".form-group").show();
		} else {
			food_selector.closest(".cruiseDayForm").find(".food").closest(".form-group").hide();
		}
	}
	
	$(function() {
		$('.cruiseDayForm').formset({
			prefix: '{{ cruiseday_form.prefix }}',
			formCssClass: 'cruisedays',
			addCssClass: 'btn btn-success add-cruise-day',
			addText: 'Add cruise day', 
			deleteText: 'Remove cruise day',
			added: wrap
		});
		
		$('.participantForm').formset({
			prefix: '{{ participant_form.prefix }}',
			formCssClass: 'participants',
			addCssClass: 'btn btn-success add-participant', 
			addText: 'Add participant',
			deleteText: 'Remove participant',
			added: wrap
		});
		
		wrap('.cruiseDayForm'); 
		wrap('.participantForm');
		
		$('.cruiseDayForm').each(function(){
			var cruiseForm = this;
			$(cruiseForm).find(".food").each(function(e){
				if ((Number($(this).val()) > 0)) {
					$(cruiseForm).find(".foodSelector").prop("checked", true);
				}
			});
		});
		
		$(".foodSelector").each(function() {
			checkAndHideFoodFields(this);
		});
	})
</script>
{% endblock %}
{# Read the documentation for more information #}